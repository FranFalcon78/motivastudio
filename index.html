<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CursoPlayer Web â€” by Fran FalcÃ³n (Rev 3)</title>
<meta name="theme-color" content="#131834">
<style>
  :root{
    --bg:#0d1021;
    --panel:#131834;
    --panel-2:#0f132b;
    --border:#1f264a;
    --text:#e9ecf5;
    --muted:#b5bdd6;
    --rail:#273058;
    --rail-fill:#c94055;
    --ab:#1d7a46;
    --ab-rail:#1d7a4699;
    --btn:#1a2144;
    --btn-h:#232c5b;
    --badge:#2b3a86;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", "Helvetica Neue", Arial;
    -webkit-user-select:none; user-select:none;}
  a{color:#9ec3ff;text-decoration:none}
  a:hover{text-decoration:underline}
  .app{display:grid;grid-template-rows:auto 1fr auto;gap:.6rem;height:100%;padding:.6rem}
  .shell{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:.5rem}
  .topbar{display:flex;gap:.45rem;align-items:center;flex-wrap:wrap}
  .brand{display:flex;gap:.5rem;align-items:center;margin-right:.25rem;font-weight:600}
  .badge{font-size:.75rem;background:var(--badge);border:1px solid var(--border);color:#bcd3ff;padding:.15rem .45rem;border-radius:999px}
  input#file{display:none}
  button{appearance:none;border:1px solid var(--border);background:var(--btn);color:var(--text);
    padding:.55rem .7rem;border-radius:10px;cursor:pointer;transition:.12s;white-space:nowrap}
  button:hover{background:var(--btn-h)}
  button.ghost{background:transparent}
  .btn-blue{background:#1e2f97} .btn-blue:hover{background:#2638af}
  .btn-green{background:#1d7a46} .btn-green:hover{background:#249a59}
  .btn-amber{background:#754d10} .btn-amber:hover{background:#946321}
  .btn-red{background:#79222b} .btn-red:hover{background:#962a36}
  .btn-dark{background:#1d2249} .btn-dark:hover{background:#242c62}
  .video-wrap{position:relative;background:black;border:1px solid var(--border);border-radius:14px;overflow:hidden;min-height:40vh}
  video{width:100%;height:100%;display:block;background:black}
  .mirror{transform:scaleX(-1)}
  .overlay{position:absolute;inset:0;pointer-events:none}
  .bottom{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:.6rem}
  .labels{display:flex;gap:.75rem;color:var(--muted)}
  .tc{color:var(--muted);font-variant-numeric:tabular-nums}
  .credit{grid-column:1/-1;color:#aeb6d3;font-size:.82rem;opacity:.9;text-align:center}
  .tl{position:relative;height:36px;user-select:none}
  .tl-rail{position:absolute;left:2%;right:2%;top:50%;height:8px;transform:translateY(-50%);
    background:linear-gradient(180deg, #3a426b 0%, var(--rail) 100%);border-radius:999px;outline:1px solid var(--border)}
  .tl-fill{position:absolute;left:2%;top:50%;height:8px;transform:translateY(-50%);background:var(--rail-fill);border-radius:999px;display:none;}
  .tl-ab{position:absolute;top:50%;height:14px;transform:translateY(-50%);background:var(--ab-rail);border-radius:8px;display:none;}
  .tl-knob{position:absolute;top:50%;width:16px;height:16px;border-radius:50%;transform:translate(-50%,-50%);
    background:#ffd1d8;outline:1px solid #3a1e26;box-shadow:0 0 0 2px #0003;display:none;}
  .tl-mark{position:absolute;top:50%;width:2px;height:18px;transform:translate(-50%,-50%);background:var(--ab);display:none;}
  .tl-hit{position:absolute;inset:0;cursor:pointer}
  @media (max-width:860px){
    .bottom{grid-template-columns:1fr;gap:.35rem}
    .credit{font-size:.78rem}
  }
</style>
</head>
<body oncontextmenu="return false">
<div class="app" id="app">
  <div class="shell">
    <div class="topbar" role="toolbar" aria-label="Controles de CursoPlayer">
      <div class="brand">CursoPlayerWeb</div>
      <input id="file" type="file" accept="video/*" />
      <button id="openBtn" class="btn-dark">ðŸ“‚ Abrir</button>
      <button id="playBtn" class="btn-blue">â–¶ Reproducir</button>
      <button id="mirrorBtn" class="btn-dark">Espejo: OFF</button>
      <button id="infoBtn" class="btn-dark">â„¹ Info</button>
      <button id="fsBtn" class="btn-dark">Pantalla completa</button>
      <button id="rateDown" class="btn-amber">Vel-</button>
      <button id="rateUp" class="btn-amber">Vel+</button>
      <button id="rateReset" class="btn-amber">Vel 1.00x</button>
      <button id="markA" class="btn-green">Marca A</button>
      <button id="markB" class="btn-green">Marca B</button>
      <button id="clearAB" class="btn-dark">Desmarcar A-B</button>
      <button id="loopBtn" class="btn-red">Bucle A-B: OFF</button>
    </div>
  </div>
  <div class="video-wrap">
    <video id="vid" preload="metadata" playsinline></video>
    <div class="overlay"></div>
  </div>
  <div class="shell">
    <div class="bottom">
      <div class="labels">
        <span class="tc" id="tcA">A: --:--:--.---</span>
        <span class="tc" id="tcB">B: --:--:--.---</span>
      </div>
      <div class="tl" id="timeline" aria-label="LÃ­nea de tiempo">
        <div class="tl-rail"></div>
        <div class="tl-fill" id="tlFill"></div>
        <div class="tl-ab" id="tlAB"></div>
        <div class="tl-mark" id="markAline"></div>
        <div class="tl-mark" id="markBline"></div>
        <div class="tl-knob" id="tlKnob" style="left:0%"></div>
        <div class="tl-hit" title="Arrastra para navegar"></div>
      </div>
      <div class="tc"><span id="tcNow">00:00:00.000</span> / <span id="tcDur">00:00:00.000</span></div>
      <div class="credit">
        CursoPlayer Â© 2025 Francisco Javier FalcÃ³n MuÃ±oz â€”
        <a href="mailto:falcon.fjf@gmail.com" rel="author noopener noreferrer">falcon.fjf@gmail.com</a>
        &nbsp;â€¢&nbsp;
        <span class="tc">Atajos: Espacio reproducir/pausar Â· J/L vel-/vel+ Â· K vel normal Â· A/B marcas Â· F pantalla completa</span>
      </div>
    </div>
  </div>
</div>
<!-- Modal Info -->
<div class="shell" id="infoModal" style="display:none; position:fixed; inset:0; background:#0007;align-items:center;justify-content:center;">
  <div style="background:var(--panel);border:1px solid var(--border);max-width:min(720px,90vw);border-radius:14px;padding:1rem">
    <h3 style="margin:.2rem 0 1rem">InformaciÃ³n del clip</h3>
    <div id="infoText" style="color:var(--muted)"></div>
    <div style="margin-top:.9rem;display:flex;gap:.5rem;justify-content:flex-end">
      <button id="closeInfo" class="ghost">Cerrar</button>
    </div>
  </div>
</div>
<script type="module">
// Elementos
const fileInput = document.getElementById('file');
const openBtn = document.getElementById('openBtn');
const video = document.getElementById('vid');
const tlKnob = document.getElementById('tlKnob');
const tlFill = document.getElementById('tlFill');
const timeline = document.getElementById('timeline');
const tcNow = document.getElementById('tcNow');
const tcDur = document.getElementById('tcDur');
const playBtn = document.getElementById('playBtn');

// Oculta la progresiÃ³n hasta que el video estÃ© listo
function hideTimelineElems() {
  tlKnob.style.display = "none";
  tlFill.style.display = "none";
  document.getElementById('tlAB').style.display = "none";
  document.getElementById('markAline').style.display = "none";
  document.getElementById('markBline').style.display = "none";
}
function showTimelineElems() {
  tlKnob.style.display = "";
  tlFill.style.display = "";
  // Puedes manejar la lÃ³gica de mostrar el resto segÃºn implementaciÃ³n de marcas
}

// Inicialmente ocultar timeline elementos
hideTimelineElems();

// Abrir archivo de video
openBtn.addEventListener('click', () => fileInput.click());

// Cuando se selecciona video
fileInput.addEventListener('change', () => {
  if (fileInput.files.length) {
    const file = fileInput.files[0];
    const url = URL.createObjectURL(file);
    video.src = url;
    video.load();
    // Deja play manual para que el botÃ³n funcione
    tcDur.textContent = "Cargando...";
  }
});

// Cuando el video estÃ¡ listo
video.addEventListener('loadedmetadata', () => {
  showTimelineElems();
  tcDur.textContent = msf(video.duration * 1000);
  tcNow.textContent = msf(0);
  updateTimeline();
});

// Actualizar la barra de progreso y el knob al reproducir
video.addEventListener('timeupdate', updateTimeline);

function updateTimeline() {
  if (video.duration > 0) {
    const pct = (video.currentTime / video.duration) * 96 + 2; // asumiendo rail left/right 2%
    tlKnob.style.left = `${pct}%`;
    tlFill.style.width = `${pct-2}%`;
    tcNow.textContent = msf(video.currentTime * 1000);
  }
}

// Convertir segundos MS a HH:MM:SS.mmm
function msf(ms) {
  let s = Math.floor(ms/1000), z=(ms%1000);
  let h = Math.floor(s/3600), m = Math.floor((s%3600)/60), ss = s%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${ss.toString().padStart(2,"0")}.${z.toString().padStart(3,"0")}`;
}

// BotÃ³n de reproducciÃ³n
playBtn.addEventListener('click', () => {
  if(video.src) {
    if(video.paused) video.play();
    else video.pause();
  }
});

</script>
</body>
</html>
